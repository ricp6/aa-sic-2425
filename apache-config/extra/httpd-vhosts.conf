<VirtualHost *:80>
    ProxyPreserveHost On
    
    <Proxy balancer://backend-cluster>
        BalancerMember http://backend1:8080 route=backend1
        BalancerMember http://backend2:8080 route=backend2
        ProxySet lbmethod=byrequests
    </Proxy>

    # Balancer Manager - DEVE vir ANTES do ProxyPass /
    <Location /balancer-manager>
        SetHandler balancer-manager
        Require all granted
        # Desativa cache para desenvolvimento
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
    </Location>

    # Exclusão específica para evitar conflitos
    ProxyPass /balancer-manager !
    
    # Roteamento para o backend
    ProxyPass /api balancer://backend-cluster/api
    ProxyPassReverse /api balancer://backend-cluster/api
    
    # Roteamento para o frontend (deve ser a última regra)
    ProxyPass / http://frontend:4200/
    ProxyPassReverse / http://frontend:4200/

</VirtualHost>