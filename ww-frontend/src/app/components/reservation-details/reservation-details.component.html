<div id="reservation-details-container">
  <section id="reservation-details-header">
    <button mat-icon-button type="button" (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h1 id="title">Reservation Details</h1>
  </section>

  <div *ngIf="reservation" class="details-card">
    <mat-card>
      <mat-card-header>
        <mat-card-title class="track-name-display">{{ reservation.trackName }}</mat-card-title>
        <mat-card-subtitle class="reservation-id-display">Reservation #{{ reservation.id }}</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="detail-row">
          <mat-icon class="detail-icon">event</mat-icon>
          <span>Date: {{ formatDate(reservation.reservationDate) }}</span>
        </div>
        <div class="detail-row">
          <mat-icon class="detail-icon">info</mat-icon>
          <span>Status: <span class="status-{{ reservation.status }}">{{ reservation.status | titlecase }}</span></span>
        </div>
        <div class="detail-row">
          <mat-icon class="detail-icon">payment</mat-icon>
          <span>Price: {{ reservation.price }} â‚¬</span>
        </div>

        <mat-divider></mat-divider>

        <h3 class="group-title">Participants ({{ reservation.participants.length }})</h3>
        <div class="participants-list">
          <div *ngIf="reservation.participants.length === 0" class="no-data">No participants for this reservation.</div>
          <div *ngFor="let participant of reservation.participants" class="participant-item">
            <mat-icon>person</mat-icon>
            <span>{{ participant.userName }} (Kart #{{ participant.kartNumber }})</span>
          </div>
        </div>

        <mat-divider></mat-divider>

        <h3 class="group-title">Sessions ({{ reservation.sessions.length }})</h3>
        <div class="sessions-list">
          <div *ngIf="reservation.sessions.length === 0" class="no-data">
            No sessions for this reservation.
          </div>
          <div *ngFor="let session of reservation.sessions" class="session-item">
            <span class="session-time">
              {{ formatTime(session.bookedStartTime) }} - {{ formatTime(session.bookedEndTime) }}
            </span>
            
            <!-- Client view, session details -->
            <button *ngIf="!isEnterpriseView && hasEnded(session)"
                    mat-icon-button
                    type="button" 
                    [routerLink]="['/sessions', session.id]"
                    class="view-session-button"
                    matTooltip="View Session Details">
              <mat-icon>launch</mat-icon>
            </button>
            
            <!-- Enterprise view, start session -->
            <button *ngIf="isEnterpriseView && canStartSession(session)"
                    mat-stroked-button
                    type="button" 
                    color="primary"
                    (click)="startSession(session.id)"
                    class="start-session-button">
              <mat-icon>play_arrow</mat-icon>
              Start Session
            </button>

            <!-- Enterprise view, finish session -->
            <button *ngIf="isEnterpriseView && isOpen(session)"
                    mat-stroked-button
                    type="button" 
                    color="warn"
                    (click)="endSession(session.id)"
                    class="finish-session-button">
              <mat-icon>stop</mat-icon>
              Finish Session
            </button>
          </div>
        </div>
      </mat-card-content>

      <mat-card-actions align="end" class="detail-actions" *ngIf="reservation.status !== 'CANCELLED'">
        <!-- CLIENT VIEW ACTIVE RESERVATIONS-->
        <ng-container *ngIf="!isEnterpriseView && isActive()">
          <button mat-flat-button type="button" color="primary" (click)="editReservation()" disabled>
            <mat-icon>edit</mat-icon>
            Edit
          </button>
          <button mat-flat-button type="button" color="warn" (click)="cancelReservation()">
            <mat-icon>cancel</mat-icon>
            Cancel Reservation
          </button>
        </ng-container>
        <!-- CLIENT VIEW CONCLUDED RESERVATIONS-->
        <ng-container *ngIf="!isEnterpriseView && reservation.status === 'CONCLUDED'">
          <div *ngIf="!isEnterpriseView && reservation.status === 'CONCLUDED'" class="reservation-actions">
            <button mat-flat-button type="button" color="primary" class="reservation-action repeat"
              (click)="goToCreateReservation()">
              Repeat Reservation
            </button>
          </div>
        </ng-container>

        <!-- ENTERPRISE VIEW ACTIVE RESERVATIONS -->
        <ng-container *ngIf="isEnterpriseView && isActive()">
          <button mat-flat-button type="button" color="primary" (click)="acceptReservation()" *ngIf="reservation.status !== 'ACCEPTED'">
            <mat-icon>check_circle</mat-icon>
            Accept
          </button>
          <button mat-flat-button type="button" color="warn" (click)="rejectReservation()">
            <mat-icon>cancel</mat-icon>
            Reject
          </button>
        </ng-container>
      </mat-card-actions>
    </mat-card>
  </div>

  <div *ngIf="!reservation" class="loading-message">
    Loading reservation details...
  </div>
</div>
